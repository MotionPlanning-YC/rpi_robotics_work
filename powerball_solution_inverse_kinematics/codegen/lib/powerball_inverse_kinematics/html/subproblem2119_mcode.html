<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S57T19U917">theta1</span>,<span class="var type1" id="S58T19U918">theta2</span>]=subproblem2(<span class="var type1" id="S59T5U921">k1</span>,<span class="var type1" id="S60T5U922">k2</span>,<span class="var type1" id="S61T5U923">p</span>,<span class="var type1" id="S62T5U924">q</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="comment">% Finds theta1 &amp; theta2 where two vectors p &amp; q intersect when rotated about vectors k1 and k2</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="mxinfo" id="T2:U7"><span class="var type1" id="S63T2U927">k12</span>=<span class="mxinfo" id="T2:U9"><span class="mxinfo" id="T16:U10"><span class="var type1" id="S59T5U930">k1</span>'</span>*<span class="var type1" id="S60T5U931">k2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="mxinfo" id="T2:U13"><span class="var type1" id="S64T2U934">pk</span>=<span class="mxinfo" id="T2:U15"><span class="mxinfo" id="T16:U16"><span class="var type1" id="S61T5U937">p</span>'</span>*<span class="var type1" id="S60T5U938">k2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo" id="T2:U19"><span class="var type1" id="S65T2U941">qk</span>=<span class="mxinfo" id="T2:U21"><span class="mxinfo" id="T16:U22"><span class="var type1" id="S62T5U944">q</span>'</span>*<span class="var type1" id="S59T5U945">k1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">% check if solution exists</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T6:U25"><span class="mxinfo" id="T2:U26">abs(<span class="mxinfo" id="T2:U27"><span class="mxinfo" id="T2:U28"><span class="var type1" id="S63T2U953">k12</span>^2</span>-<span class="mxinfo" id="T2:U30">1</span></span>)</span>&lt;<span class="mxinfo" id="T2:U31">eps</span></span>;<span class="mxinfo" id="T19:U32"><span class="var type1" id="S57T19U960">theta1</span>=<span class="mxinfo" id="T19:U34">[<span class="mxinfo" id="T2:U35">NaN</span> <span class="mxinfo" id="T2:U36">NaN</span>]</span></span>; <span class="mxinfo" id="T19:U37"><span class="var type1" id="S58T19U969">theta2</span>=<span class="mxinfo" id="T19:U39">[<span class="mxinfo" id="T2:U40">NaN</span> <span class="mxinfo" id="T2:U41">NaN</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line">    <span class="mxinfo" id="T39:U42"><span class="autoExtrinsicFcn" id="F208N2:B978">disp</span>(<span class="mxinfo" id="T40:U43"><span class="string">'no solution (***1***)'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line"><span class="mxinfo" id="T18:U44"><span class="var type1" id="S70T18U983">a</span>=<span class="mxinfo" id="T18:U46"><span class="mxinfo" id="T18:U47"><span class="mxinfo" id="T17:U48">[<span class="mxinfo" id="T19:U49"><span class="var type1" id="S63T2U988">k12</span> <span class="mxinfo" id="T2:U51">-<span class="mxinfo" id="T2:U52">1</span></span></span>;<span class="mxinfo" id="T19:U53"><span class="mxinfo" id="T2:U54">-<span class="mxinfo" id="T2:U55">1</span></span> <span class="var type1" id="S63T2U994">k12</span></span>]</span>*<span class="mxinfo" id="T18:U57">[<span class="var type1" id="S64T2U997">pk</span>;<span class="var type1" id="S65T2U999">qk</span>]</span></span>/(<span class="mxinfo" id="T2:U60"><span class="mxinfo" id="T2:U61"><span class="var type1" id="S63T2U1003">k12</span>^2</span>-<span class="mxinfo" id="T2:U63">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line"><span class="mxinfo" id="T2:U64"><span class="var type1" id="S71T2U1008">bb</span>=(<span class="mxinfo" id="T2:U66"><span class="mxinfo" id="T2:U67"><span class="mxinfo" id="T2:U68"><span class="mxinfo" id="T2:U69">norm(<span class="var type1" id="S61T5U1015">p</span>)</span>^2</span>-<span class="mxinfo" id="T2:U71"><span class="mxinfo" id="T2:U72">norm(<span class="var type1" id="S70T18U1020">a</span>)</span>^2</span></span>-<span class="mxinfo" id="T2:U74"><span class="mxinfo" id="T2:U75"><span class="mxinfo" id="T2:U76"><span class="mxinfo" id="T2:U77">2</span>*<span class="mxinfo" id="T2:U78"><span class="var type1" id="S70T18U1027">a</span>(<span class="mxinfo" id="T2:U80">1</span>)</span></span>*<span class="mxinfo" id="T2:U81"><span class="var type1" id="S70T18U1030">a</span>(<span class="mxinfo" id="T2:U83">2</span>)</span></span>*<span class="var type1" id="S63T2U1032">k12</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T6:U85"><span class="mxinfo" id="T2:U86">abs(<span class="var type1" id="S71T2U1038">bb</span>)</span>&lt;<span class="mxinfo" id="T2:U88">eps</span></span>;<span class="mxinfo" id="T2:U89"><span class="var type1" id="S71T2U1043">bb</span>=<span class="mxinfo" id="T2:U91">0</span></span>;<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T6:U92"><span class="var type1" id="S71T2U1048">bb</span>&lt;<span class="mxinfo" id="T2:U94">0</span></span>;<span class="mxinfo" id="T19:U95"><span class="var type1" id="S57T19U1052">theta1</span>=<span class="mxinfo" id="T19:U97">[<span class="mxinfo" id="T2:U98">NaN</span> <span class="mxinfo" id="T2:U99">NaN</span>]</span></span>;<span class="mxinfo" id="T19:U100"><span class="var type1" id="S58T19U1061">theta2</span>=<span class="mxinfo" id="T19:U102">[<span class="mxinfo" id="T2:U103">NaN</span> <span class="mxinfo" id="T2:U104">NaN</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">    <span class="mxinfo" id="T39:U105"><span class="autoExtrinsicFcn" id="F209N2:B1070">disp</span>(<span class="mxinfo" id="T40:U106"><span class="string">'no solution (***2***)'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">    <span class="keyword">return</span>;<span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line"><span class="comment">% check if there is only 1 solution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo" id="T2:U107"><span class="var type1" id="S73T2U1075">gamma</span>=<span class="mxinfo" id="T2:U109"><span class="mxinfo" id="T2:U110">sqrt(<span class="var type1" id="S71T2U1079">bb</span>)</span>/<span class="mxinfo" id="T2:U112">norm(<span class="mxinfo" id="T5:U113">cross(<span class="var type1" id="S59T5U1084">k1</span>,<span class="var type1" id="S60T5U1085">k2</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T6:U116"><span class="mxinfo" id="T2:U117">abs(<span class="var type1" id="S73T2U1091">gamma</span>)</span>&lt;<span class="mxinfo" id="T2:U119">eps</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">    <span class="mxinfo" id="T5:U120"><span class="var type1" id="S76T5U1096">c1</span>=<span class="mxinfo" id="T5:U122"><span class="mxinfo" id="T4:U123">[<span class="var type1" id="S59T5U1100">k1</span> <span class="var type1" id="S60T5U1101">k2</span> <span class="mxinfo" id="T5:U126">cross(<span class="var type1" id="S59T5U1104">k1</span>,<span class="var type1" id="S60T5U1105">k2</span>)</span>]</span>*<span class="mxinfo" id="T5:U129">[<span class="var type1" id="S70T18U1108">a</span>;<span class="var type1" id="S73T2U1110">gamma</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">    <span class="mxinfo" id="T19:U132"><span class="var type1" id="S58T19U1113">theta2</span>=<span class="mxinfo" id="T19:U134">[<span class="mxinfo" id="T2:U135"><span class="fcn" id="F118N6:B1117">subproblem1</span>(<span class="var type1" id="S60T5U1118">k2</span>,<span class="var type1" id="S61T5U1119">p</span>,<span class="var type1" id="S76T5U1120">c1</span>)</span> <span class="mxinfo" id="T2:U139">NaN</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">    <span class="mxinfo" id="T19:U140"><span class="var type1" id="S57T19U1125">theta1</span>=<span class="mxinfo" id="T19:U142">[<span class="mxinfo" id="T2:U143">-<span class="mxinfo" id="T2:U144"><span class="fcn" id="F118N6:B1130">subproblem1</span>(<span class="var type1" id="S59T5U1131">k1</span>,<span class="var type1" id="S62T5U1132">q</span>,<span class="var type1" id="S76T5U1133">c1</span>)</span></span> <span class="mxinfo" id="T2:U148">NaN</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="comment">% general case: 2 solutions</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line"><span class="mxinfo" id="T19:U149"><span class="var type1" id="S57T19U1138">theta1</span>=<span class="mxinfo" id="T19:U151">zeros(<span class="mxinfo" id="T2:U152">1</span>,<span class="mxinfo" id="T2:U153">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"><span class="mxinfo" id="T19:U154"><span class="var type1" id="S58T19U1145">theta2</span>=<span class="mxinfo" id="T19:U156">zeros(<span class="mxinfo" id="T2:U157">1</span>,<span class="mxinfo" id="T2:U158">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"><span class="mxinfo" id="T5:U159"><span class="var type1" id="S76T5U1152">c1</span>=<span class="mxinfo" id="T5:U161"><span class="mxinfo" id="T4:U162">[<span class="var type1" id="S59T5U1156">k1</span> <span class="var type1" id="S60T5U1157">k2</span> <span class="mxinfo" id="T5:U165">cross(<span class="var type1" id="S59T5U1160">k1</span>,<span class="var type1" id="S60T5U1161">k2</span>)</span>]</span>*<span class="mxinfo" id="T5:U168">[<span class="var type1" id="S70T18U1164">a</span>;<span class="var type1" id="S73T2U1166">gamma</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"><span class="mxinfo" id="T5:U171"><span class="var type1" id="S79T5U1169">c2</span>=<span class="mxinfo" id="T5:U173"><span class="mxinfo" id="T4:U174">[<span class="var type1" id="S59T5U1173">k1</span> <span class="var type1" id="S60T5U1174">k2</span> <span class="mxinfo" id="T5:U177">cross(<span class="var type1" id="S59T5U1177">k1</span>,<span class="var type1" id="S60T5U1178">k2</span>)</span>]</span>*<span class="mxinfo" id="T5:U180">[<span class="var type1" id="S70T18U1181">a</span>;<span class="mxinfo" id="T2:U182">-<span class="var type1" id="S73T2U1184">gamma</span></span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line"><span class="mxinfo" id="T2:U184"><span class="mxinfo" id="T2:U185"><span class="var type1" id="S58T19U1188">theta2</span>(<span class="mxinfo" id="T2:U187">1</span>)</span>=<span class="mxinfo" id="T2:U188"><span class="fcn" id="F118N6:B1191">subproblem1</span>(<span class="var type1" id="S60T5U1192">k2</span>,<span class="var type1" id="S61T5U1193">p</span>,<span class="var type1" id="S76T5U1194">c1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line"><span class="mxinfo" id="T2:U192"><span class="mxinfo" id="T2:U193"><span class="var type1" id="S58T19U1198">theta2</span>(<span class="mxinfo" id="T2:U195">2</span>)</span>=<span class="mxinfo" id="T2:U196"><span class="fcn" id="F118N6:B1201">subproblem1</span>(<span class="var type1" id="S60T5U1202">k2</span>,<span class="var type1" id="S61T5U1203">p</span>,<span class="var type1" id="S79T5U1204">c2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line"><span class="mxinfo" id="T2:U200"><span class="mxinfo" id="T2:U201"><span class="var type1" id="S57T19U1208">theta1</span>(<span class="mxinfo" id="T2:U203">1</span>)</span>=<span class="mxinfo" id="T2:U204">-<span class="mxinfo" id="T2:U205"><span class="fcn" id="F118N6:B1212">subproblem1</span>(<span class="var type1" id="S59T5U1213">k1</span>,<span class="var type1" id="S62T5U1214">q</span>,<span class="var type1" id="S76T5U1215">c1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo" id="T2:U209"><span class="mxinfo" id="T2:U210"><span class="var type1" id="S57T19U1219">theta1</span>(<span class="mxinfo" id="T2:U212">2</span>)</span>=<span class="mxinfo" id="T2:U213">-<span class="mxinfo" id="T2:U214"><span class="fcn" id="F118N6:B1223">subproblem1</span>(<span class="var type1" id="S59T5U1224">k1</span>,<span class="var type1" id="S62T5U1225">q</span>,<span class="var type1" id="S79T5U1226">c2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line"></span></span>
</pre>
